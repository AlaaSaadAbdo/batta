name: "KiCad CI/CD for Swipe Light main board"

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  workflow_dispatch:
  push:
    paths:
      # - '*.kicad_sch'
      - '*'
      - '*.kibot.yaml'
      - '.github/workflows/run-kibot.yml'

jobs:
  render:
    strategy:
      fail-fast: false
      matrix:
        board: [ 
          boards/30keys/Asfoora/Asfoora,
          boards/30keys/Batreeq/Batreeq,
          boards/30keys/battoota/battoota,
          boards/30keys/battoota_min/battoota_min,
          boards/30keys/wizza/wizza,
          boards/30keys/Wizza-chocV1-MX_Spacing/wizza,
          boards/30keys/wizza-chocV2/wizza,
          boards/30keys/wizza-mx/wizza,
          boards/32keys/battoota-3thumb/battoota,
          boards/32keys/konafa/konafa,
          boards/32keys/konafa_min/konafa_min,
          boards/34keys/basbousa/basbousa,
          boards/36keys/basbousa36/basbousa
          ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: INTI-CMNB/KiBot@v2_k6
      with:
        # Required - kibot config file
        config: main.kibot.yaml
        # optional - prefix to output defined in config
        dir: gallery/
        # optional - schematic file
        # schema: 'main.kicad_sch'
        # optional - PCB design file
        board: "${{ matrix.board }}.kicad_pcb"
    - uses: actions/upload-artifact@main
      with:
        name: ${{ matrix.board }}
        path: images/${{ matrix.board }}

  publish: 
    needs: render
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/download-artifact@v3
        with:
          path: images/
      - uses: stefanzweifel/git-auto-commit-action@v4.14.1
        with:
          commit_message: "Update gallery (automated)"
          commit_user_name: GitHub Actions Bot
